(function(b,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):(b=typeof globalThis<"u"?globalThis:b||self,b.Evervault=g())})(this,function(){var B,D,j,k;"use strict";var Se=(b,g,S)=>{if(!g.has(b))throw TypeError("Cannot "+S)};var P=(b,g,S)=>(Se(b,g,"read from private field"),S?S.call(b):g.get(b)),z=(b,g,S)=>{if(g.has(b))throw TypeError("Cannot add the same private member more than once");g instanceof WeakSet?g.add(b):g.set(b,S)},M=(b,g,S,R)=>(Se(b,g,"write to private field"),R?R.call(b,S):g.set(b,S),S);function b(e){return globalThis.Buffer!=null?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function g(e=0){var t;return((t=globalThis.Buffer)==null?void 0:t.allocUnsafe)!=null?b(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function S(e,t){t==null&&(t=e.reduce((o,i)=>o+i.length,0));const n=g(t);let r=0;for(const o of e)n.set(o,r),r+=o.length;return b(n)}function R(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),s=i.charCodeAt(0);if(n[s]!==255)throw new TypeError(i+" is ambiguous");n[s]=o}var a=e.length,u=e.charAt(0),_=Math.log(a)/Math.log(256),y=Math.log(256)/Math.log(a);function f(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";for(var l=0,m=0,w=0,E=c.length;w!==E&&c[w]===0;)w++,l++;for(var A=(E-w)*y+1>>>0,C=new Uint8Array(A);w!==E;){for(var x=c[w],U=0,L=A-1;(x!==0||U<m)&&L!==-1;L--,U++)x+=256*C[L]>>>0,C[L]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");m=U,w++}for(var O=A-m;O!==A&&C[O]===0;)O++;for(var q=u.repeat(l);O<A;++O)q+=e.charAt(C[O]);return q}function p(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;var l=0;if(c[l]!==" "){for(var m=0,w=0;c[l]===u;)m++,l++;for(var E=(c.length-l)*_+1>>>0,A=new Uint8Array(E);c[l];){var C=n[c.charCodeAt(l)];if(C===255)return;for(var x=0,U=E-1;(C!==0||x<w)&&U!==-1;U--,x++)C+=a*A[U]>>>0,A[U]=C%256>>>0,C=C/256>>>0;if(C!==0)throw new Error("Non-zero carry");w=x,l++}if(c[l]!==" "){for(var L=E-w;L!==E&&A[L]===0;)L++;for(var O=new Uint8Array(m+(E-L)),q=m;L!==E;)O[q++]=A[L++];return O}}}function v(c){var l=p(c);if(l)return l;throw new Error(`Non-${t} character`)}return{encode:f,decodeUnsafe:p,decode:v}}var Le=R,Oe=Le;const Ue=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Be=e=>new TextEncoder().encode(e),Pe=e=>new TextDecoder().decode(e);class Me{constructor(t,n,r){this.name=t,this.prefix=n,this.baseEncode=r}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class Te{constructor(t,n,r){if(this.name=t,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return ne(this,t)}}class De{constructor(t){this.decoders=t}or(t){return ne(this,t)}decode(t){const n=t[0],r=this.decoders[n];if(r)return r.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ne=(e,t)=>new De({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class je{constructor(t,n,r,o){this.name=t,this.prefix=n,this.baseEncode=r,this.baseDecode=o,this.encoder=new Me(t,n,r),this.decoder=new Te(t,n,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const G=({name:e,prefix:t,encode:n,decode:r})=>new je(e,t,n,r),I=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:o}=Oe(n,t);return G({prefix:e,name:t,encode:r,decode:i=>Ue(o(i))})},Ie=(e,t,n,r)=>{const o={};for(let y=0;y<t.length;++y)o[t[y]]=y;let i=e.length;for(;e[i-1]==="=";)--i;const s=new Uint8Array(i*n/8|0);let a=0,u=0,_=0;for(let y=0;y<i;++y){const f=o[e[y]];if(f===void 0)throw new SyntaxError(`Non-${r} character`);u=u<<n|f,a+=n,a>=8&&(a-=8,s[_++]=255&u>>a)}if(a>=n||255&u<<8-a)throw new SyntaxError("Unexpected end of data");return s},Ke=(e,t,n)=>{const r=t[t.length-1]==="=",o=(1<<n)-1;let i="",s=0,a=0;for(let u=0;u<e.length;++u)for(a=a<<8|e[u],s+=8;s>n;)s-=n,i+=t[o&a>>s];if(s&&(i+=t[o&a<<n-s]),r)for(;i.length*n&7;)i+="=";return i},F=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>G({prefix:t,name:e,encode(o){return Ke(o,r,n)},decode(o){return Ie(o,r,n,e)}}),$e=G({prefix:"\0",name:"identity",encode:e=>Pe(e),decode:e=>Be(e)}),Ne=Object.freeze(Object.defineProperty({__proto__:null,identity:$e},Symbol.toStringTag,{value:"Module"})),ke=F({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),ze=Object.freeze(Object.defineProperty({__proto__:null,base2:ke},Symbol.toStringTag,{value:"Module"})),Re=F({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Ge=Object.freeze(Object.defineProperty({__proto__:null,base8:Re},Symbol.toStringTag,{value:"Module"})),Je=I({prefix:"9",name:"base10",alphabet:"0123456789"}),He=Object.freeze(Object.defineProperty({__proto__:null,base10:Je},Symbol.toStringTag,{value:"Module"})),Ve=F({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),We=F({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Ye=Object.freeze(Object.defineProperty({__proto__:null,base16:Ve,base16upper:We},Symbol.toStringTag,{value:"Module"})),Xe=F({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qe=F({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qe=F({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ze=F({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),et=F({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),tt=F({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),nt=F({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rt=F({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ot=F({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),it=Object.freeze(Object.defineProperty({__proto__:null,base32:Xe,base32hex:et,base32hexpad:nt,base32hexpadupper:rt,base32hexupper:tt,base32pad:Qe,base32padupper:Ze,base32upper:qe,base32z:ot},Symbol.toStringTag,{value:"Module"})),st=I({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),at=I({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ct=Object.freeze(Object.defineProperty({__proto__:null,base36:st,base36upper:at},Symbol.toStringTag,{value:"Module"})),ut=I({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ft=I({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),lt=Object.freeze(Object.defineProperty({__proto__:null,base58btc:ut,base58flickr:ft},Symbol.toStringTag,{value:"Module"})),dt=F({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),pt=F({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ht=F({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),yt=F({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),bt=Object.freeze(Object.defineProperty({__proto__:null,base64:dt,base64pad:pt,base64url:ht,base64urlpad:yt},Symbol.toStringTag,{value:"Module"})),re=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),wt=re.reduce((e,t,n)=>(e[n]=t,e),[]),vt=re.reduce((e,t,n)=>(e[t.codePointAt(0)]=n,e),[]);function mt(e){return e.reduce((t,n)=>(t+=wt[n],t),"")}function gt(e){const t=[];for(const n of e){const r=vt[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);t.push(r)}return new Uint8Array(t)}const xt=G({prefix:"🚀",name:"base256emoji",encode:mt,decode:gt}),Ft=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:xt},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const oe={...Ne,...ze,...Ge,...He,...Ye,...it,...ct,...lt,...bt,...Ft};function ie(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const se=ie("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),Q=ie("ascii","a",e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},e=>{e=e.substring(1);const t=g(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}),ae={utf8:se,"utf-8":se,hex:oe.base16,latin1:Q,ascii:Q,binary:Q,...oe};function K(e,t="utf8"){const n=ae[t];if(n==null)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?b(globalThis.Buffer.from(e,"utf-8")):n.decoder.decode(`${n.prefix}${e}`)}function Z(e,t="utf8"){const n=ae[t];if(n==null)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):n.encoder.encode(e).substring(1)}const J=e=>e.constructor.name==="Array",Et=e=>typeof ArrayBuffer=="function"&&(e instanceof ArrayBuffer||Object.prototype.toString.call(e)==="[object ArrayBuffer]"),At=e=>typeof e=="object",ce=e=>N(e)&&At(e)&&!J(e)&&!Et(e),$=e=>typeof e=="string",_t=e=>$(e)&&e.length===0,N=e=>typeof e<"u"&&e!==null,Ct=e=>typeof e>"u",St=e=>typeof e=="number",Lt=e=>typeof e=="boolean",Ot=e=>e instanceof File||e instanceof Blob,ue=e=>N(e)&&($(e)||St(e)||Lt(e)),fe=e=>{if(N(e))return J(e)?e.constructor.name:typeof e},le=e=>{if(!Ct(e))return N(e)?$(e)?e.trim():["bigint","function"].includes(typeof e)?e.toString():JSON.stringify(e):JSON.stringify(e)};class H extends Error{constructor(t){super(t),this.type=this.constructor.name}}class ee extends H{}class Ut extends H{}class Bt extends H{}class Pt extends H{}function h(){var e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.join("").replace(/\s+/g,"").toLowerCase(),r=n.length/2,o=0,i=t;if(r!==Math.round(r))throw new Error("invalid hex");if(r>127)for(o+=1;r>255;)o+=1,r=r>>8;return o&&(i+=h.numToHex(128+o)),i+h.numToHex(n.length/2)+n}h.UInt=function(){var t=Array.prototype.slice.call(arguments).join(""),n=parseInt(t.slice(0,2),16);return 128&n&&(t="00"+t),h("02",t)},h.BitStr=function(){var t=Array.prototype.slice.call(arguments).join("");return h("03","00"+t)},h.numToHex=function(e){return e=e.toString(16),e.length%2?"0"+e:e};function Mt(e){const t=Tt(e);return n=>t(Z(K(n,"base64"),"hex"))}function Tt({p:e,a:t,b:n,seed:r,generator:o,n:i,h:s}){return a=>{const u=h("30",h("30",h("06","2A 86 48 CE 3D 02 01"),h("30",h.UInt("01"),h("30",h("06","2A 86 48 CE 3D 01 01"),h.UInt(e)),h("30",h("04",t),h("04",n),h.BitStr(r)),h("04",o),h.UInt(i),h.UInt(s))),h.BitStr(a));return K(u,"hex")}}const Dt=Mt({p:"FF FF FF FF 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF FF FF FF FF",a:"FF FF FF FF 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 FF FF FF FF FF FF FF FF FF FF FF FC",b:"5A C6 35 D8 AA 3A 93 E7 B3 EB BD 55 76 98 86 BC 65 1D 06 B0 CC 53 B0 F6 3B CE 3C 3E 27 D2 60 4B",seed:"C4 9D 36 08 86 E7 04 93 6A 66 78 E1 13 9D 26 B7 81 9F 7E 90",generator:"04 6B 17 D1 F2 E1 2C 42 47 F8 BC E6 E5 63 A4 40 F2 77 03 7D 81 2D EB 33 A0 F4 A1 39 45 D8 98 C2 96 4F E3 42 E2 FE 1A 7F 9B 8E E7 EB 4A 7C 0F 9E 16 2B CE 33 57 6B 31 5E CE CB B6 40 68 37 BF 51 F5",n:"FF FF FF FF 00 00 00 00 FF FF FF FF FF FF FF FF BC E6 FA AD A7 17 9E 84 F3 B9 CA C2 FC 63 25 51",h:"01"});function te(e){const t=new Uint8Array(e),n=t.byteLength,r=t.slice(0,1+n>>>1);return r[0]=2|t[n-1]&1,r}async function jt(e,t,n){const r=await window.crypto.subtle.importKey("raw",K(t,"base64"),{name:"ECDH",namedCurve:"P-256"},!0,[]),o=await window.crypto.subtle.deriveKey({name:"ECDH",public:r},e.privateKey,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),i=await window.crypto.subtle.exportKey("raw",n),s=await window.crypto.subtle.exportKey("raw",o),a=S([new Uint8Array(s),new Uint8Array([0,0,0,1]),Dt(Z(new Uint8Array(i),"base64"))]);return await window.crypto.subtle.digest("SHA-256",a)}async function It(e){const t=te(K(e,"base64")),n=Z(new Uint8Array(t),"base64");return{ecdhP256KeyUncompressed:e,ecdhP256Key:n,isDebugMode:!1}}function de(e){var t,n;return e=e.trim(),(n=e.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im))&&(t=n[1],(n=t.match(/^[^\.]+\.(.+\..+)$/))&&(t=n[1])),t}function Kt(e){if(e){if(e.height)return e.height;if(e.theme==="minimal"||e.theme==="material")return"145px"}return"180px"}function $t(e,t){let n="";t&&Object.keys(t).map(s=>{n+=`&${s}=${encodeURIComponent(t[s])}`});const{inputsUrl:r}=e.input,{teamId:o,appId:i}=e;return`${r}?team=${o}&app=${i}${n}
  `}const Nt="https://keys.evervault.com",pe="https://inputs.evervault.com",kt=`${pe}/v2/index.html`,V={keysUrl:Nt,inputsUrl:kt,inputsOrigin:pe},he=25;function zt(e,t,n=V,r){return{teamId:e,appId:t,encryption:{cipherAlgorithm:"aes-256-gcm",keyLength:32,ivLength:12,authTagLength:128,publicHash:"sha256",evVersion:"NOC",header:{iss:"evervault",version:1},publicKey:r,maxFileSizeInMB:he,maxFileSizeInBytes:he*1024*1024},http:{keysUrl:n.keysUrl||V.keysUrl},input:{inputsUrl:n.inputsUrl||V.inputsUrl,inputsOrigin:n.inputsOrigin||V.inputsOrigin},debugKey:{ecdhP256KeyUncompressed:"BF1/Mo85D7t/XvC3I+YYpJvP+OsSyxIbSrhtDhg1SClQ2xdoyGpXYrplO/f8AZ+7cGkUnMF3tzSfLC5Io8BuNyw=",ecdhP256Key:"Al1/Mo85D7t/XvC3I+YYpJvP+OsSyxIbSrhtDhg1SClQ",isDebugMode:!0}}}const ye=async e=>{let t=new Uint8Array(e);if(window.crypto)return window.crypto.getRandomValues(t),t;throw new Ut("Your browser is outdated and does not support the Web Crypto API. Please upgrade it.")};function be(e,t){const n=async(f,p,v,c)=>await r(f,p,v,{...c}),r=async(f,p,v,c)=>{if(ue(c))return await i(f,p,v,le(c),fe(c));if(ce(c)){const l={...c};for(let[m,w]of Object.entries(l))l[m]=await r(f,p,v,w);return l}else if(J(c)){const l=[...c];for(let[m,w]of Object.entries(l))l[m]=await r(f,p,v,w);return l}else return c},o=async(f,p,v,c)=>{if(c.size>e.maxFileSizeInBytes)throw new Pt(`File size must be less than ${e.maxFileSizeInMB}MB`);const l=await ye(e.ivLength),m=await window.crypto.subtle.importKey("raw",v,{name:"AES-GCM"},!0,["encrypt"]);return new Promise((w,E)=>{const A=new window.FileReader;A.onloadend=C=>{A.result||E({error:"Failed to read file to be encrypted"}),window.crypto.subtle.encrypt({name:"AES-GCM",iv:l,tagLength:e.authTagLength,additionalData:f},m,A.result).then(x=>_(l,p,x,c.name)).then(x=>w(x)).catch(x=>E(x))},A.readAsArrayBuffer(c)})},i=async(f,p,v,c,l)=>{const m=await ye(e.ivLength),w=await window.crypto.subtle.importKey("raw",v,{name:"AES-GCM"},!0,["encrypt"]),E=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m,tagLength:e.authTagLength,additionalData:f},w,new TextEncoder().encodeInto(c));return await u(l,new TextDecoder("base64").decode(m),p,new TextDecoder("base64").decode(E))},s=f=>f.replace(/={1,2}$/,""),a=s(new TextDecoder("base64").decode(new TextEncoder().encode(e.evVersion))),u=async(f="string",p,v,c)=>{const l=await window.crypto.subtle.exportKey("raw",v),m=te(l);return`ev:${t?"debug:":""}${a}${f!=="string"?":"+f:""}:${s(p)}:${s(new TextDecoder("base64").decode(m))}:${s(c)}:$`},_=async(f,p,v,c)=>{const l=await window.crypto.subtle.exportKey("raw",p),m=te(l),w=new Uint8Array([37,69,86,69,78,67]),E=new Uint8Array([1]),A=new Uint8Array([55,0]),C=t?new Uint8Array([1]):new Uint8Array([0]),x=concat([w,E,A,m,f,C,new TextEncoder("utf-8").encode(v)]);return c?new File([x],c,{type:"application/octet-stream"}):new Blob([x],{type:"application/octet-stream"})};return{encrypt:async(f,p,v,c)=>{if(!N(c))throw new Error("Data must not be undefined");if(Ot(c))return await o(f,p,v,c);if(ce(c))return await n(f,p,v,c);if(J(c))return await r(f,p,v,[...c]);if(ue(c))return await i(f,p,v,le(c),fe(c));throw new Error("Data supplied is not encryptable")}}}function Rt(e,t,n,r){if(!window.fetch)throw new ee("Your browser is outdated and does not support window.fetch(). Please upgrade it.");const o=(a,u,_,y={},f=void 0)=>{const p={method:a,headers:{...e.headers,...y}};return f&&(p.body=JSON.stringify(f)),window.fetch(`${_}/${u}`,p)},i=async(a,u,_)=>{const y=await o("GET",u,a,_);return{headers:y.headers,body:await y.json()}};return{getCageKey:async()=>{try{const{headers:a,body:u}=await i(e.keysUrl,`${t}/apps/${n}?context=${r}`);return{...u,isDebugMode:a.get("X-Evervault-Inputs-Debug-Mode")==="true"}}catch{throw new Bt("An error occurred while retrieving the cage's key")}}}}var W={},Gt={get exports(){return W},set exports(e){W=e}},T=typeof Reflect=="object"?Reflect:null,we=T&&typeof T.apply=="function"?T.apply:function(t,n,r){return Function.prototype.apply.call(t,n,r)},Y;T&&typeof T.ownKeys=="function"?Y=T.ownKeys:Object.getOwnPropertySymbols?Y=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Y=function(t){return Object.getOwnPropertyNames(t)};function Jt(e){console&&console.warn&&console.warn(e)}var ve=Number.isNaN||function(t){return t!==t};function d(){d.init.call(this)}Gt.exports=d,W.once=Yt,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var me=10;function X(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return me},set:function(e){if(typeof e!="number"||e<0||ve(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");me=e}}),d.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||ve(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function ge(e){return e._maxListeners===void 0?d.defaultMaxListeners:e._maxListeners}d.prototype.getMaxListeners=function(){return ge(this)},d.prototype.emit=function(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var o=t==="error",i=this._events;if(i!==void 0)o=o&&i.error===void 0;else if(!o)return!1;if(o){var s;if(n.length>0&&(s=n[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=i[t];if(u===void 0)return!1;if(typeof u=="function")we(u,this,n);else for(var _=u.length,y=_e(u,_),r=0;r<_;++r)we(y[r],this,n);return!0};function xe(e,t,n,r){var o,i,s;if(X(n),i=e._events,i===void 0?(i=e._events=Object.create(null),e._eventsCount=0):(i.newListener!==void 0&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),s===void 0)s=i[t]=n,++e._eventsCount;else if(typeof s=="function"?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),o=ge(e),o>0&&s.length>o&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=s.length,Jt(a)}return e}d.prototype.addListener=function(t,n){return xe(this,t,n,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(t,n){return xe(this,t,n,!0)};function Ht(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Fe(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=Ht.bind(r);return o.listener=n,r.wrapFn=o,o}d.prototype.once=function(t,n){return X(n),this.on(t,Fe(this,t,n)),this},d.prototype.prependOnceListener=function(t,n){return X(n),this.prependListener(t,Fe(this,t,n)),this},d.prototype.removeListener=function(t,n){var r,o,i,s,a;if(X(n),o=this._events,o===void 0)return this;if(r=o[t],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===n||r[s].listener===n){a=r[s].listener,i=s;break}if(i<0)return this;i===0?r.shift():Vt(r,i),r.length===1&&(o[t]=r[0]),o.removeListener!==void 0&&this.emit("removeListener",t,a||n)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(t){var n,r,o;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var i=Object.keys(r),s;for(o=0;o<i.length;++o)s=i[o],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(o=n.length-1;o>=0;o--)this.removeListener(t,n[o]);return this};function Ee(e,t,n){var r=e._events;if(r===void 0)return[];var o=r[t];return o===void 0?[]:typeof o=="function"?n?[o.listener||o]:[o]:n?Wt(o):_e(o,o.length)}d.prototype.listeners=function(t){return Ee(this,t,!0)},d.prototype.rawListeners=function(t){return Ee(this,t,!1)},d.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):Ae.call(e,t)},d.prototype.listenerCount=Ae;function Ae(e){var t=this._events;if(t!==void 0){var n=t[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}d.prototype.eventNames=function(){return this._eventsCount>0?Y(this._events):[]};function _e(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function Vt(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function Wt(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function Yt(e,t){return new Promise(function(n,r){function o(s){e.removeListener(t,i),r(s)}function i(){typeof e.removeListener=="function"&&e.removeListener("error",o),n([].slice.call(arguments))}Ce(e,t,i,{once:!0}),t!=="error"&&Xt(e,o,{once:!0})})}function Xt(e,t,n){typeof e.on=="function"&&Ce(e,"error",t,n)}function Ce(e,t,n,r){if(typeof e.on=="function")r.once?e.once(t,n):e.on(t,n);else if(typeof e.addEventListener=="function")e.addEventListener(t,function o(i){r.once&&e.removeEventListener(t,o),n(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}function qt(e){const t=new W.EventEmitter;return{handleForm:async function(n){let r;const o=n.querySelectorAll("input");let i={};for(let s=0;s<o.length;s++){r=o[s];let{id:a,name:u,value:_}=r;if(a||u)if(r.hasAttribute("data-encrypt")){const y=await e.encrypt(_);let f=document.createElement("input");f.type="hidden",f.value=y,f.setAttribute("data-evervault-created","yes"),a&&(f.id=a.replace("ev-hidden-","")),u&&(f.name=u.replace("ev-hidden-","")),n.appendChild(f),r.id&&r.id.startsWith("ev-hidden-")&&(r.id=`ev-hidden-${a}`),r.name="",n[a||u].value=y,i[a?a.replace("ev-hidden-",""):u.replace("ev-hidden-","")]=y}else n[a||u].value=_,i[a||u]=_}return i},register:function(){const n=document.querySelectorAll("[data-evervault-form]");let r;for(let o=0;o<n.length;o++){r=n[o];let i=r.onsubmit;r.onsubmit=async s=>{s.preventDefault();const a=await this.handleForm(r);if(this.events.emit("form-ready",a),r.getAttribute("data-evervault-form")==="auto")i?i():r.submit();else return!1}}},events:t}}function Qt(e){return{generate:function(t,n){return document.getElementById(t).innerHTML=`<iframe src="${$t(e,n)}" id="ev-iframe" title="Payment details" frameborder="0" scrolling="0" height=${Kt(n)}></iframe>`,{getData:()=>new Promise((r,o)=>{const i=new MessageChannel;i.port1.onmessage=({data:s})=>(i.port1.close(),r(s)),document.getElementById("ev-iframe").contentWindow.postMessage("message","*",[i.port2])}),on:(r,o)=>{r==="change"&&window.addEventListener("message",i=>{i.origin===e.input.inputsOrigin&&o(i.data)},!1)},setLabels:r=>{const o=new MessageChannel;document.getElementById("ev-iframe").contentWindow.postMessage(r,"*",[o.port2])}}}}}class Zt{constructor(t,n,r={}){z(this,B,void 0);z(this,D,void 0);z(this,j,void 0);z(this,k,void 0);if(!$(t))throw new ee("teamId must be a string");if(!$(n))throw new ee("appId must be a string");r||(r={isDebugMode:!1}),r.isDebugMode?M(this,B,!0):M(this,B,!1),this.config=zt(t,n,r.urls,r.publicKey),this.crypto=be(this.config.encryption,this.isInDebugMode()),window.location.origin===this.config.input.inputsUrl?this.context="inputs":this.context="default",this.http=Rt(this.config.http,this.config.teamId,this.config.appId,this.context),this.forms=qt(this),this.forms.register(),this.input=Qt(this.config)}async loadKeys(){if(P(this,D)!=null)return;const t=this.config.encryption.publicKey?await It(this.config.encryption.publicKey):this.isInDebugMode()?this.config.debugKey:await this.http.getCageKey();M(this,D,K(t.ecdhP256Key,"base64"));const n=await window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveBits","deriveKey"]);M(this,j,n.publicKey),this.isInDebugMode()||M(this,B,t.isDebugMode),this.crypto=be(this.config.encryption,this.isInDebugMode()),M(this,k,await jt(n,t.ecdhP256KeyUncompressed,P(this,j)))}async encrypt(t){if(_t(t))return t;this.keysLoadingPromise||(this.keysLoadingPromise=this.loadKeys()),await this.keysLoadingPromise;try{return await this.crypto.encrypt(P(this,D),P(this,j),P(this,k),t)}catch(n){throw n}}inputs(t,n){try{return typeof n=="string"?this.input.generate(t,{theme:n}):this.input.generate(t,n||{})}catch(r){throw r}}auto(t=[]){global.oldFetch||(global.oldFetch=global.fetch,global.fetch=async(n,r)=>{const{body:o}=r,i=de(n),s=de(window.location.hostname);if(i===s)try{const a=JSON.parse(o);for(const u of Object.keys(a))(t.length===0||t.includes(u))&&(a[u]=await this.encrypt(a[u]));r.body=JSON.stringify(a)}catch{}return global.oldFetch(n,r)})}isInDebugMode(){return P(this,B)}}return B=new WeakMap,D=new WeakMap,j=new WeakMap,k=new WeakMap,Zt});
